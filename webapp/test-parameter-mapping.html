<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCADA Parameter Mapping Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .panel h2 {
            margin-top: 0;
            color: #667eea;
            font-size: 18px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }

        .control-group input[type="range"] {
            width: 100%;
        }

        .control-group .value-display {
            display: inline-block;
            min-width: 60px;
            text-align: right;
            font-weight: 600;
            color: #667eea;
        }

        #svgContainer {
            min-height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #fafafa;
            border-radius: 8px;
            padding: 20px;
        }

        #svgContainer svg {
            max-width: 100%;
            height: auto;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .status {
            padding: 10px;
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            border-radius: 4px;
            margin-top: 15px;
            font-size: 14px;
        }

        @media (max-width: 968px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SCADA Parameter Mapping Test</h1>
        <p class="subtitle">Test the parameter mapping feature with sample SCADA diagrams</p>

        <div class="test-grid">
            <div class="panel">
                <h2>Parameter Controls</h2>

                <div class="control-group">
                    <label>
                        Water Tank Level:
                        <span class="value-display" id="tankLevelValue">50</span>%
                    </label>
                    <input type="range" id="tankLevel" min="0" max="100" value="50">
                </div>

                <div class="control-group">
                    <label>
                        Temperature:
                        <span class="value-display" id="tempValue">25</span>°C
                    </label>
                    <input type="range" id="temperature" min="0" max="100" value="25">
                </div>

                <div class="control-group">
                    <label>
                        Pressure:
                        <span class="value-display" id="pressureValue">100</span> PSI
                    </label>
                    <input type="range" id="pressure" min="0" max="200" value="100">
                </div>

                <div class="control-group">
                    <label>
                        Flow Rate:
                        <span class="value-display" id="flowValue">125</span> L/min
                    </label>
                    <input type="range" id="flowRate" min="0" max="250" value="125">
                </div>

                <div class="button-group">
                    <button onclick="startSimulation()">Start Simulation</button>
                    <button onclick="stopSimulation()">Stop</button>
                    <button onclick="resetValues()">Reset</button>
                </div>

                <div class="status">
                    <strong>Status:</strong> <span id="statusText">Ready</span>
                </div>
            </div>

            <div class="panel">
                <h2>Sample SCADA Diagram</h2>
                <div id="svgContainer"></div>
            </div>
        </div>

        <div class="panel" style="margin-top: 20px;">
            <h2>Instructions</h2>
            <ol>
                <li>Draw your SCADA diagram in the draw.io editor</li>
                <li>Right-click on any element and select "Set Parameter Mapping..."</li>
                <li>Configure the parameter name and type</li>
                <li>Export as SVG</li>
                <li>Use the exported SVG in your React application</li>
                <li>Update parameters in real-time using MQTT/MODBUS/REST API</li>
            </ol>
        </div>
    </div>

    <script>
        let simulationInterval = null;

        function createSampleSVG() {
            const svg = `
                <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="tankGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                            <stop offset="0%" stop-color="#0066cc" data-scada-stop="fill"/>
                            <stop offset="50%" stop-color="#0066cc" data-scada-stop="transition" data-scada-param-offset="{{TANK_LEVEL}}"/>
                            <stop offset="50%" stop-color="#e0e0e0" data-scada-stop="empty"/>
                            <stop offset="100%" stop-color="#e0e0e0" data-scada-stop="empty"/>
                        </linearGradient>
                    </defs>

                    <!-- Tank -->
                    <rect x="50" y="50" width="100" height="150"
                          fill="url(#tankGradient)"
                          stroke="#333"
                          stroke-width="2"
                          data-scada-param="TANK_LEVEL"
                          data-scada-type="gradient-level"
                          data-scada-direction="bottom-to-top"
                          data-scada-min="0"
                          data-scada-max="100"
                          data-scada-fill-color="#0066cc"
                          data-scada-empty-color="#e0e0e0"/>

                    <!-- Tank Label -->
                    <text x="100" y="220" text-anchor="middle" font-size="14" font-weight="bold" fill="#333">
                        Water Tank
                    </text>

                    <!-- Tank Level Text -->
                    <text x="100" y="240" text-anchor="middle" font-size="16" fill="#0066cc"
                          data-scada-param="TANK_LEVEL"
                          data-scada-type="text">
                        50%
                    </text>

                    <!-- Temperature Sensor -->
                    <circle cx="250" cy="100" r="40" fill="#ff6b6b" stroke="#333" stroke-width="2"/>
                    <text x="250" y="95" text-anchor="middle" font-size="12" fill="white">Temp</text>
                    <text x="250" y="115" text-anchor="middle" font-size="18" font-weight="bold" fill="white"
                          data-scada-param="TEMPERATURE"
                          data-scada-type="text">
                        25°C
                    </text>

                    <!-- Pressure Gauge -->
                    <rect x="200" y="160" width="100" height="40" rx="5" fill="#4ecdc4" stroke="#333" stroke-width="2"/>
                    <text x="250" y="180" text-anchor="middle" font-size="12" fill="white">Pressure</text>
                    <text x="250" y="195" text-anchor="middle" font-size="14" font-weight="bold" fill="white"
                          data-scada-param="PRESSURE"
                          data-scada-type="text">
                        100 PSI
                    </text>
                </svg>
            `;

            document.getElementById('svgContainer').innerHTML = svg;
        }

        function updateParameters() {
            const tankLevel = document.getElementById('tankLevel').value;
            const temperature = document.getElementById('temperature').value;
            const pressure = document.getElementById('pressure').value;
            const flowRate = document.getElementById('flowRate').value;

            document.getElementById('tankLevelValue').textContent = tankLevel;
            document.getElementById('tempValue').textContent = temperature;
            document.getElementById('pressureValue').textContent = pressure;
            document.getElementById('flowValue').textContent = flowRate;

            updateSVG({
                TANK_LEVEL: tankLevel,
                TEMPERATURE: temperature,
                PRESSURE: pressure,
                FLOW_RATE: flowRate
            });
        }

        function updateSVG(parameters) {
            const svg = document.querySelector('#svgContainer svg');
            if (!svg) return;

            const tankGradient = svg.querySelector('#tankGradient');
            if (tankGradient) {
                const transitionStop = tankGradient.querySelector('[data-scada-stop="transition"]');
                const emptyStops = tankGradient.querySelectorAll('[data-scada-stop="empty"]');

                if (transitionStop && emptyStops.length > 0) {
                    const percentage = parameters.TANK_LEVEL;
                    transitionStop.setAttribute('offset', `${percentage}%`);
                    emptyStops[0].setAttribute('offset', `${percentage}%`);
                }
            }

            const textElements = svg.querySelectorAll('[data-scada-type="text"]');
            textElements.forEach(element => {
                const paramName = element.getAttribute('data-scada-param');

                if (paramName === 'TANK_LEVEL') {
                    element.textContent = `${parameters.TANK_LEVEL}%`;
                } else if (paramName === 'TEMPERATURE') {
                    element.textContent = `${parameters.TEMPERATURE}°C`;
                } else if (paramName === 'PRESSURE') {
                    element.textContent = `${parameters.PRESSURE} PSI`;
                }
            });
        }

        function startSimulation() {
            if (simulationInterval) return;

            document.getElementById('statusText').textContent = 'Simulation Running';

            simulationInterval = setInterval(() => {
                const tankLevel = 30 + Math.random() * 40;
                const temperature = 20 + Math.random() * 20;
                const pressure = 80 + Math.random() * 60;
                const flowRate = 100 + Math.random() * 80;

                document.getElementById('tankLevel').value = tankLevel;
                document.getElementById('temperature').value = temperature;
                document.getElementById('pressure').value = pressure;
                document.getElementById('flowRate').value = flowRate;

                updateParameters();
            }, 1000);
        }

        function stopSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
                document.getElementById('statusText').textContent = 'Simulation Stopped';
            }
        }

        function resetValues() {
            stopSimulation();

            document.getElementById('tankLevel').value = 50;
            document.getElementById('temperature').value = 25;
            document.getElementById('pressure').value = 100;
            document.getElementById('flowRate').value = 125;

            updateParameters();
            document.getElementById('statusText').textContent = 'Reset Complete';
        }

        document.getElementById('tankLevel').addEventListener('input', updateParameters);
        document.getElementById('temperature').addEventListener('input', updateParameters);
        document.getElementById('pressure').addEventListener('input', updateParameters);
        document.getElementById('flowRate').addEventListener('input', updateParameters);

        createSampleSVG();
        updateParameters();
    </script>
</body>
</html>
